<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Gallery Remote Protocol</title><meta name="generator" content="DocBook XSL Stylesheets V1.61.3"><link rel="home" href="index.html" title="Gallery Manual"><link rel="up" href="gallery-remote.html" title="Chapter 4. Gallery Remote"><link rel="previous" href="gallery-remote.problems.html" title="Known Problems"><link rel="next" href="gallery-remote.faq.html" title="Frequently Asked Questions"><link rel="stylesheet" href="html.css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Gallery Remote Protocol</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="gallery-remote.problems.html">Prev</a> </td><th width="60%" align="center">Chapter 4. Gallery Remote</th><td width="20%" align="right"> <a accesskey="n" href="gallery-remote.faq.html">Next</a></td></tr></table><hr></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gallery-remote.protocol"></a>Gallery Remote Protocol</h2></div></div><div></div></div><div class="toc"><dl><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.introduction">Introduction</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.overview">Overview</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.interactions">Client-server interactions</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.requests">Requests</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.responses">Responses</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.cmd">Commands</a></dt><dt><a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes">Appendix A: Response Status Codes</a></dt></dl></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.introduction"></a>Introduction</h3></div></div><div></div></div><p>This document describes version 2 of the Gallery remote application protocol, and its minor revisions.</p><p>The "Gallery Remote" remote administration program is this protocol's <span class="foreignphrase"><i class="foreignphrase">raison d'être</i></span>. Version 1 of the protocol was tied very tightly to that application. It is clear that in addition to Gallery Remote users, there is a growing number of users that would like to query and control Gallery installations with their own programs.</p><p>Version 2 adds some extra features but (hopefully) greater potential for other remote applications based on Gallery. If you would like to make suggestions for future work on the Gallery Remote protocol, please submit them to either of the authors.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.overview"></a>Overview</h3></div></div><div></div></div><p>Gallery remote queries and sends information from a Gallery server through a protocol based on HTTP and form-data. The protocol leverages the same user authentication (and session cookies) as the web/HTML interface to the site. It is implemented in the PHP source file gallery_remote2.php.</p><p>Each query from client to server corresponds to one action. Multiple actions require multiple HTTP requests.</p><p>The protocol is stateful and depends on the client supporting cookies. The client must provide login credentials for the session to be validated by sending a login request before any other requests will succeed.</p><p>Permissions for actions performed by <tt class="filename">gallery_remote2.php</tt> are controlled in the same way they are controlled for regular web/HTML users of Gallery. <tt class="filename">init.php</tt> is called before each request is processed by the server.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.interactions"></a>Client-server interactions</h3></div></div><div></div></div><p>All client-server interaction follows the standard HTTP model. The client initiates all interactions with a <a href="gallery-remote.protocol.html#gallery-remote.protocol.requests" title="Requests">request</a>. The server always responds with one response. The data format of each request is HTTP form-data key/value pairs. The data format of each response is plain text key/value pairs.</p><p>Each request specifies a command value (and possibly some corresponding parameters) which determines the content of the response. Command-specific responses are defined in the context of each command below).</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.requests"></a>Requests</h3></div></div><div></div></div><p>Each request from the client is sent to the server through an HTTP POST. Parameters of the request are expressed as HTTP form data. Form data uses a key / value format referred to in <a href="http://www.w3.org/TR/REC-html40/interact/forms.html#control-name" target="_top">the spec</a> as "control-name / current value." Here we simply refer to <span class="emphasis"><em>key</em></span> and <span class="emphasis"><em>value</em></span>.</p><p>Each request must specify a command (the <tt class="varname">cmd</tt> key). Depending on which command is specified, other key/value pairs are required in the form-data set (as parameters).</p><p>Each request must specify a protocol version (the <tt class="varname">protocol_version</tt> key).</p><p>The server's response to the <a href="gallery-remote.protocol.html#gallery-remote.protocol.cmd.login" title="Login">login</a> command includes the version of the protocol it implements (with the <tt class="varname">server_version </tt>key). Protocol numbers obey the following convention:</p><p><tt class="varname"><i class="replaceable"><tt>maj</tt></i>.<i class="replaceable"><tt>min</tt></i></tt></p><p>where <tt class="varname"><i class="replaceable"><tt>maj</tt></i></tt> is the major version number and <tt class="varname"><i class="replaceable"><tt>min</tt></i></tt> is the minor version number. Different major versions of the protocol use different <tt class="filename">gallery_remote<tt class="varname"><i class="replaceable"><tt>maj</tt></i></tt>.php</tt> files. Each such file may provide support for various minor versions.</p><p>Each command is described in the <a href="gallery-remote.protocol.html#gallery-remote.protocol.cmd" title="Commands">Commands</a> section below. After a brief description of the command, template form data appears and the contents of the server's response is described.</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.responses"></a>Responses</h3></div></div><div></div></div><p>After the client POSTs a request, the server sends a response to the client. The format of the response is a key/value format compatible with the Java "Properties" stream format.</p><p>In a nutshell: lines beginning with a <tt class="literal">#</tt> character are ignored. The text before the first <tt class="literal">=</tt> character is the key. The remainder of the text after the <tt class="literal">=</tt> until the end-of-line character(s) is the value.</p><p>Each response must begin with the text <tt class="literal">#__GR2PROTO__</tt>. Clients should ignore any text above this tag: it might be debug output from the server.</p><p>Each response must contain at least the keys: <tt class="varname">status</tt> and <tt class="varname">status_text</tt>.</p><p>The value associated with the <tt class="varname">status</tt> key is an integer status code (the codes are defined in <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes">Appendix A</a>. For example, if the server was able to complete the command in the client's request, the value of the <tt class="varname">status</tt> code will be <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>.</p><p>The <tt class="varname">status</tt> key is definitive, yet the <tt class="varname">status_text</tt> may contain human-readable additional information (likely to be English language only).</p><p>Otherwise, if the server was not able to successfully complete the request, the status will be a non-zero integer (see <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes">Appendix A: Response Status Codes</a>).</p></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.cmd"></a>Commands</h3></div></div><div></div></div><p></p><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.login"></a>Login</h4></div></div><div></div></div><p>The <tt class="varname">login</tt> command adds the proper user object to the session (if the username and password are correct). It also returns to the client the version of the protocol the server is prepared to support.</p><p>The <tt class="varname">login</tt> command is not strictly necessary: if it is not used, the server will assume anonymous access and the protocol will be able to access data that is accessible by anybody. In this mode, it is unlikely the new albums can be created and photos uploaded.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916726"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command may be made at any time -- there are no prerequisites.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916744"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=login
protocol_version=<i class="replaceable"><tt>2.0</tt></i>
uname=<i class="replaceable"><tt>gallery-user-name</tt></i>
password=<i class="replaceable"><tt>cleartext-password</tt></i></pre><p>where <tt class="varname"><i class="replaceable"><tt>gallery-user-name</tt></i></tt> is a valid gallery user name and <tt class="varname"><i class="replaceable"><tt>cleartext-password</tt></i></tt> is the corresponding password.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916784"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
#__GR2PROTO__
status=<i class="replaceable"><tt>result-code</tt></i>
status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
server_version=<i class="replaceable"><tt>major-version</tt></i>.<i class="replaceable"><tt>minor-version</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the login completed successfully and the user's session has been updated. Any other command can now be used in requests to this server.</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.fetch-albums"></a>Getting a list of albums</h4></div></div><div></div></div><p>The <tt class="varname">fetch-albums</tt> command asks the server to return a list of all albums (visible with the client's logged in user permissions).</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916868"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command must be made before the <tt class="varname">fetch-albums</tt> command is used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916889"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=fetch-albums
protocol_version=<i class="replaceable"><tt>2.0</tt></i></pre></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2916906"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
          #__GR2PROTO__
         status=result-code
         status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
        /album.name.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>album-url-name</tt></i>
        |album.title.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>album-display-name</tt></i>
        |album.parent.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>parent-ref-num</tt></i>
  0...n |album.perms.add.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.write.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.del_item.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.del_alb.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.create_sub.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        \album.info.extrafields.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>extra-fields</tt></i><span class="productnumber"> [since 2.3]</span>
         album_count=<i class="replaceable"><tt>number-of-albums</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the album data was fetched successfully.</p><p>If successful, a response to the <tt class="varname">fetch-albums</tt> command returns several keys for each album in the gallery, where</p><div class="itemizedlist"><ul type="disc" compact><li><p><tt class="varname"><i class="replaceable"><tt>ref-num</tt></i></tt> is a reference number,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-url-name</tt></i></tt> is the name of the partial URL for the gallery,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-display-name</tt></i></tt> is the gallery's visual name,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>parent-ref-num</tt></i></tt> refers to some other album's ref-num. A <tt class="varname"><i class="replaceable"><tt>parent-ref-num</tt></i></tt> of <tt class="varname">0</tt> (zero) indicates that the album is a "top-level" album (it has no parent).</p></li><li><p><tt class="varname"><i class="replaceable"><tt>extra-fields</tt></i></tt> is a comma-separated list of extra fields names,</p></li><li><p>and <tt class="varname"><i class="replaceable"><tt>boolean</tt></i></tt> represents a boolean value. <tt class="varname">true</tt> is considered true, any other value false.</p></li></ul></div><p>Several "permissions" are reported for each album. The reported permissions are the effective permissions of the currently logged in user:</p><div class="itemizedlist"><ul type="disc"><li><p>the <tt class="varname">add</tt> permission allows the user to add a picture to the album.</p></li><li><p>the <tt class="varname">write</tt> permission allows the user to add and change pictures in the album.</p></li><li><p>the <tt class="varname">del_item</tt> permission allows the user remove pictures from the album.</p></li><li><p>the <tt class="varname">del_alb</tt> permission allows the user to delete the album.</p></li><li><p>the <tt class="varname">create_sub</tt> permission allows the user to create nested albums in the album.</p></li></ul></div><p>The number of albums in the response is returned as <tt class="varname"><i class="replaceable"><tt>number-of-albums</tt></i></tt>.</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.fetch-albums-prune"></a>Getting a list of albums v2, more efficient [since 2.2]</h4></div></div><div></div></div><p>The <tt class="varname">fetch-albums-prune</tt> command asks the server to return a list of all albums that the user can either write to, or that are visible to the user and contain a sub-album that is writable (including sub-albums several times removed).</p><p>The reason for this slightly altered version of <tt class="varname">fetch-albums</tt> is two-fold: the previous version was slow on the server-side, because of the way it was structured, and limitation in the Gallery mode of operation; it returns all albums the the user can read, even if writing is not allowed. This new version is faster, because it uses a more efficient algorithm to find albums; it is more efficient because it only sends albums that are useful to the client. It also doesn't parse the pictures database, which makes it run much faster on the server.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917292"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command must be made before the <tt class="varname">fetch-albums-prune</tt> command is used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917313"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=fetch-albums-prune
protocol_version=<i class="replaceable"><tt>2.2</tt></i></pre></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917333"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
          #__GR2PROTO__
         status=result-code
         status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
        /album.name.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>album-url-name</tt></i>
        |album.title.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>album-display-name</tt></i>
        |album.parent.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>parent-ref-num</tt></i>
  0...n |album.perms.add.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.write.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.del_item.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.del_alb.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        |album.perms.create_sub.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>boolean</tt></i>
        \album.info.extrafields.<i class="replaceable"><tt>ref-num</tt></i>=<i class="replaceable"><tt>extra-fields</tt></i><span class="productnumber"> [since 2.3]</span>
         album_count=<i class="replaceable"><tt>number-of-albums</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the album data was fetched successfully.</p><p>If successful, a response to the <tt class="varname">fetch-albums-prune</tt> command returns several keys for each album in the gallery, where</p><div class="itemizedlist"><ul type="disc" compact><li><p><tt class="varname"><i class="replaceable"><tt>ref-num</tt></i></tt> is a reference number,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-url-name</tt></i></tt> is the name of the partial URL for the gallery,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-display-name</tt></i></tt> is the gallery's visual name,</p></li><li><p><tt class="varname"><i class="replaceable"><tt>parent-ref-num</tt></i></tt> refers to some other album's ref-num. A <tt class="varname"><i class="replaceable"><tt>parent-ref-num</tt></i></tt> of <tt class="varname">0</tt> (zero) indicates that the album is a "top-level" album (it has no parent).</p></li><li><p><tt class="varname"><i class="replaceable"><tt>extra-fields</tt></i></tt> is a comma-separated list of extra fields names,</p></li><li><p>and <tt class="varname"><i class="replaceable"><tt>boolean</tt></i></tt> represents a boolean value. <tt class="varname">true</tt> is considered true, any other value false.</p></li></ul></div><p>Several "permissions" are reported for each album. The reported permissions are the effective permissions of the currently logged in user:</p><div class="itemizedlist"><ul type="disc"><li><p>the <tt class="varname">add</tt> permission allows the user to add a picture to the album.</p></li><li><p>the <tt class="varname">write</tt> permission allows the user to add and change pictures in the album.</p></li><li><p>the <tt class="varname">del_item</tt> permission allows the user remove pictures from the album.</p></li><li><p>the <tt class="varname">del_alb</tt> permission allows the user to delete the album.</p></li><li><p>the <tt class="varname">create_sub</tt> permission allows the user to create nested albums in the album.</p></li></ul></div><p>The number of albums in the response is returned as <tt class="varname"><i class="replaceable"><tt>number-of-albums</tt></i></tt>.</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.add-item"></a>Uploading a photo to an album</h4></div></div><div></div></div><p>The <tt class="varname">add-item</tt> command asks the server to add a photo to a specified album.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917693"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command must be made before the <tt class="varname">add-item</tt> command is used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917713"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=add-item
protocol_version=<i class="replaceable"><tt>2.0</tt></i>
set_albumName=<i class="replaceable"><tt>album name</tt></i>
userfile=<i class="replaceable"><tt>form-data-encoded image data</tt></i>
caption=<i class="replaceable"><tt>caption</tt></i> (optional) [since 2.0]
force_filename=<i class="replaceable"><tt>name of the file on the server</tt></i> (optional) [since 2.0]
auto_rotate=<i class="replaceable"><tt>yes/no</tt></i> (optional) [since 2.5]
extrafield.<i class="replaceable"><tt>fieldname</tt></i>=<i class="replaceable"><tt>value of the extra field fieldname</tt></i> (optional) [since 2.3]</pre><p>Multiple <tt class="varname">extrafield</tt> lines with different <tt class="varname"><i class="replaceable"><tt>fieldname</tt></i></tt> values can be used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917781"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
#__GR2PROTO__
status=<i class="replaceable"><tt>result-code</tt></i>
status_text=<i class="replaceable"><tt>explanatory-text</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the file upload succeeded.</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.album-properties"></a>Getting information about an album [since 2.0]</h4></div></div><div></div></div><p>The <tt class="varname">album-properties</tt> command asks the server for information about an album.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917850"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command must be made before the <tt class="varname">album-properties</tt> command is used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917870"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=album-properties
protocol_version=<i class="replaceable"><tt>2.0</tt></i>
set_albumName=<i class="replaceable"><tt>album name</tt></i></pre></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917894"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
#__GR2PROTO__
status=<i class="replaceable"><tt>result-code</tt></i>
status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
auto_resize=<i class="replaceable"><tt>resize-dimension</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the request succeeded.</p><p>If an image is uploaded such that its largest dimension is greater than <tt class="varname"><i class="replaceable"><tt>resize-dimension</tt></i></tt>, the server will resize it. Otherwise, the server will use the original image that was uploaded for both the full-sized and the resized size. In all cases a thumbnail-sized image will be created. The creation of a thumbnail is highly dependant on the size of the image that was uploaded.</p><p>If the value is <tt class="varname">0</tt> (zero), the Gallery server does not intend to resize uploaded images. </p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.new-album"></a>Creating a new album [since 2.1]</h4></div></div><div></div></div><p>The <tt class="varname">new-album</tt> command asks the server to add a photo to a specified album.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2917995"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command must be made before the <tt class="varname">new-album</tt> command is used.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2918014"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=new-album
protocol_version=<i class="replaceable"><tt>2.1</tt></i>
set_albumName=<i class="replaceable"><tt>parent-album-name</tt></i>
newAlbumName=<i class="replaceable"><tt>album-name</tt></i> (optional)
newAlbumTitle=<i class="replaceable"><tt>album-title</tt></i> (optional)
newAlbumDesc=<i class="replaceable"><tt>album-description</tt></i> (optional)</pre><div class="itemizedlist"><ul type="disc" compact><li><p><tt class="varname"><i class="replaceable"><tt>parent-album-name</tt></i></tt> is the name of the gallery that the new album should be created under, or 0 to create the album at the top-level;</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-name</tt></i></tt> is the new album's desired name. The name must be unique within the Gallery. If it is not, then Gallery will assign an automatically-generated name. An automatically generated name will also be used if this parameter is not provided or is empty;</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-title</tt></i></tt> is the new album's desired title;</p></li><li><p><tt class="varname"><i class="replaceable"><tt>album-description</tt></i></tt> is the new album's desired description.</p></li></ul></div></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2918117"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
#__GR2PROTO__
status=<i class="replaceable"><tt>result-code</tt></i>
status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
album_name=<i class="replaceable"><tt>actual-name</tt></i> [since 2.5]</pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the request succeeded.</p><p>If the <tt class="varname">result-code</tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_NO_CREATE_ALBUM_PERMISSION</tt></a>, the logged-in user doesn't have permission to create an album in the specified location.</p><p>If an album is created with the same name as an already existing album or <i class="replaceable"><tt>album-title</tt></i> is left blank, gallery will automatically generate an album name. <i class="replaceable"><tt>actual-name</tt></i> will return the name of the newly created album.</p></div></div><div class="sect3" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="gallery-remote.protocol.cmd.fetch-album-images"></a>Getting the list of photos in an album [since 2.4]</h4></div></div><div></div></div><p>The <tt class="varname">fetch-album-images</tt> command asks the server to return information about all the images in an album. It ignores sub-albums.</p><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2918233"></a>Context</h5></div></div><div></div></div><p>A request with the <tt class="varname">login</tt> command can be made before the <tt class="varname">fetch-album-images</tt> command is used, but since viewing photos in an album is generally (but not always) open to non logged-in users, a login is not always necessary.</p></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2918255"></a>Form data</h5></div></div><div></div></div><pre class="programlisting">
cmd=fetch-album-images
protocol_version=<i class="replaceable"><tt>2.4</tt></i>
set_albumName=<i class="replaceable"><tt>album-name</tt></i></pre></div><div class="sect4" lang="en"><div class="titlepage"><div><div><h5 class="title"><a name="id2918279"></a>Results</h5></div></div><div></div></div><pre class="programlisting">
         #__GR2PROTO__
         status=<i class="replaceable"><tt>result-code</tt></i>
         status_text=<i class="replaceable"><tt>explanatory-text</tt></i>
        /image.name.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>filename of the image</tt></i>
        |image.raw_width.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>the width of the full-sized image</tt></i>
        |image.raw_height.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>the height of the full-sized image</tt></i>
        |image.resizedName.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>filename of the resized image</tt></i>
        |image.raw_filesize.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>size of the full-sized image</tt></i>
        |image.caption.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>caption associated with the image</tt></i>
  0...n |image.extrafield.<i class="replaceable"><tt>fieldname</tt></i>.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>value of the extra field of key fieldname</tt></i>
        |image.clicks.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>number of clicks on the image</tt></i>
        |image.capturedate.year.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (year)</tt></i>
        |image.capturedate.mon.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (month)</tt></i>
        |image.capturedate.mday.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (day of the month)</tt></i>
        |image.capturedate.hours.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (hour)</tt></i>
        |image.capturedate.minutes.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (minute)</tt></i>
        \image.capturedate.seconds.<i class="replaceable"><tt>ref_num</tt></i>=<i class="replaceable"><tt>date of capture of the image (second)</tt></i>
         image_count=<i class="replaceable"><tt>total number of images in the album</tt></i>
         baseurl=<i class="replaceable"><tt>URL of the album</tt></i></pre><p>If the <tt class="varname"><i class="replaceable"><tt>result-code</tt></i></tt> is equal to <a href="gallery-remote.protocol.html#gallery-remote.protocol.retcodes" title="Appendix A: Response Status Codes"><tt class="varname">GR_STAT_SUCCESS</tt></a>, the request succeeded.</p><p>The baseurl contains a fully-qualified URL. A URL to each image can be obtained by appending the filename of the image to this.</p><p>The name and resizedName include the type (extension), but do not include any path information.</p><p>Multiple <tt class="varname">extrafield</tt> lines with different <tt class="varname"><i class="replaceable"><tt>fieldname</tt></i></tt> values can be used.</p></div></div></div><div class="sect2" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="gallery-remote.protocol.retcodes"></a>Appendix A: Response Status Codes</h3></div></div><div></div></div><div class="table"><a name="id2918509"></a><p class="title"><b>Table 4.1. Response Status Codes</b></p><table summary="Response Status Codes" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>Status name</th><th>Code</th><th>Description</th></tr></thead><tbody><tr><td>GR_STAT_SUCCESS</td><td>0</td><td>The command the client sent in the request completed successfully. The data (if any) in the response should be considered valid.</td></tr><tr><td>GR_STAT_PROTO_MAJ_VER_INVAL</td><td>101</td><td>The protocol major version the client is using is not supported.</td></tr><tr><td>GR_STAT_PROTO_MIN_VER_INVAL</td><td>102</td><td>The protocol minor version the client is using is not supported.</td></tr><tr><td>GR_STAT_PROTO_VER_FMT_INVAL</td><td>103</td><td>The format of the protocol version string the client sent in the request is invalid.</td></tr><tr><td>GR_STAT_PROTO_VER_MISSING</td><td>104</td><td>The request did not contain the required <tt class="varname">protocol_version</tt> key.</td></tr><tr><td>GR_STAT_PASSWD_WRONG</td><td>201</td><td>The password and/or username the client send in the request is invalid.</td></tr><tr><td>GR_STAT_LOGIN_MISSING</td><td>202</td><td>The client used the login command in the request but failed to include either the username or password (or both) in the request.</td></tr><tr><td>GR_STAT_UNKNOWN_CMD</td><td>301</td><td>The value of the <tt class="varname">cmd</tt> key is not valid.</td></tr><tr><td>GR_STAT_NO_ADD_PERMISSION</td><td>401</td><td>The user does not have permission to add an item to the gallery.</td></tr><tr><td>GR_STAT_NO_FILENAME</td><td>402</td><td>No filename was specified.</td></tr><tr><td>GR_STAT_UPLOAD_PHOTO_FAIL</td><td>403</td><td>The file was received, but could not be processed or added to the album.</td></tr><tr><td>GR_STAT_NO_CREATE_ALBUM_PERMISSION</td><td>501</td><td>A new album could not be created because the user does not have permission to do so.</td></tr><tr><td>GR_STAT_CREATE_ALBUM_FAILED</td><td>502</td><td>A new album could not be created, for a different reason (name conflict).</td></tr></tbody></table></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="gallery-remote.problems.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="gallery-remote.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="gallery-remote.faq.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Known Problems </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Frequently Asked Questions</td></tr></table></div></body></html>
