<?
require("../classes/User.php");
require("../classes/NobodyUser.php");
require("../classes/EverybodyUser.php");
require("../classes/UserDB.php");

$GALLERY_DIR = dirname(dirname(getenv("SCRIPT_FILENAME")));
$GALLERY_URL = dirname(dirname(getenv("SCRIPT_NAME")));

$outfile = "$GALLERY_DIR/config.php";
copy("gpl.txt", $outfile);
if ($fd = @fopen($outfile, "a")) {
	$data = urldecode($data);

	// Note, we should do a full entity expansion, but
	// for now just handle this case (generated by makePathWrapper())
	$data = str_replace("&#039;", "'", $data);

	fwrite($fd, $data);
	fclose($fd);
} else {
	fail($outfile);
	return;
}

$outfile = "$GALLERY_DIR/.htaccess";
$htaccess = file("htaccess.template");
if ($fd = @fopen($outfile, "w")) {
	foreach ($htaccess as $line) {
		eval("\$line = \"$line\";");
		fwrite($fd, $line);
	}
	fclose($fd);
} else {
	fail($outfile);	
	return;
}

$userDB = new UserDB();
$admin = $userDB->getOrCreateUser("admin");
$admin->setPassword($editPassword);
$admin->setIsAdmin(true);
$admin->setFullName("Administrator");
$admin->setCanCreateAlbums(true);
$admin->save();

?>

<title> Success! </title>
<center>
<table width=450><tr><td>
<center>
<font size=+2> Your configuration has been successfully saved! </font>
</center>
<p>
An account called <i>admin</i> has been created for you with the password you specified.
<p>
<center>
<font size=+2 color=red>Note!</font>
<br>
Don't forget to run:
<br>
<code>
% sh secure.sh
</code>
</center>
<br>
in your Gallery directory to make your application secure!  Gallery
won't run if it is not in secure mode.  You can reconfigure Gallery
at any time by re-running <code>configure.sh</code> and then returning
to the setup URL.

<p>
<center>
<a href=../albums.php>Enter the Gallery</a>

</td></tr></table>



<?
function fail($file) {
?>
	<title> Failure! </title>
	<font size=+2> Unable to write to <?=$file?> </font>
<?
	return;
}
?>
